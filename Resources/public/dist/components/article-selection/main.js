define(["text!./overlay.html","text!./contentItem.html","text!/admin/api/articles/fields"],function(a,b,c){"use strict";var d=JSON.parse(c),e={options:{url:"/admin/api/articles",eventNamespace:"sulu.article-selection",resultKey:"articles",dataAttribute:"article-selection",dataDefault:[],hidePositionElement:!0,hideConfigButton:!0,navigateEvent:"sulu.router.navigate",translations:{noContentSelected:"sulu_article.selection.no-result"}},templates:{overlay:a,contentItem:b},translations:{title:"public.title",overlayTitle:"sulu_article.title"}},f=function(){this.sandbox.on("husky.overlay.article-selection."+this.options.instanceName+".add.initialized",g.bind(this)),this.sandbox.on("husky.overlay.article-selection."+this.options.instanceName+".add.opened",h.bind(this)),this.sandbox.dom.on(this.$el,"click",function(a){var b=this.sandbox.dom.data(a.currentTarget,"id"),c="articles/"+this.options.locale+"/edit:"+b+"/details";return this.sandbox.emit(this.options.navigateEvent,c),!1}.bind(this),"a.link"),this.sandbox.on("husky.datagrid.article.view.rendered",function(){this.sandbox.emit("husky.overlay.article-selection."+this.options.instanceName+".add.set-position")}.bind(this))},g=function(){this.sandbox.start([{name:"search@husky",options:{appearance:"white small",instanceName:this.options.instanceName+"-article-search",el:"#article-selection-"+this.options.instanceName+"-search"}},{name:"datagrid@husky",options:{el:"#article-selection-"+this.options.instanceName+"-list",instanceName:"article",url:this.options.url,preselected:this.getData()||[],resultKey:this.options.resultKey,sortable:!1,columnOptionsInstanceName:"",clickCallback:function(a){this.sandbox.emit("husky.datagrid.article.toggle.item",a)}.bind(this),selectedCounter:!0,searchInstanceName:this.options.instanceName+"-article-search",searchFields:["id","title"],paginationOptions:{dropdown:{limit:20}},matchings:d}}])},h=function(){var a=this.getData()||[];this.sandbox.emit("husky.datagrid.article.selected.update",a)},i=function(){this.sandbox.dom.on(this.$el,"click",function(){return!1}.bind(this),".search-icon"),this.sandbox.dom.on(this.$el,"keydown",function(a){if(13===event.keyCode)return a.preventDefault(),a.stopPropagation(),!1}.bind(this),".search-input")},j=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$addButton,cssClass:"article-content-overlay",el:a,removeOnClose:!1,container:this.$el,instanceName:"article-selection."+this.options.instanceName+".add",skin:"large",okCallback:k.bind(this),title:this.translations.overlayTitle,data:this.templates.overlay({instanceName:this.options.instanceName})}}])},k=function(){var a=[],b=this.getData();this.sandbox.emit("husky.datagrid.article.items.get-selected",function(c){this.sandbox.util.foreach(c,function(c){var d=b.indexOf(c);d!==-1?a[d]=c:a.push(c)}.bind(this))}.bind(this));var c,d=Object.keys(a),e=[],f=d.length;for(c=0;c<f;c++)e.push(a[d[c]]);this.setData(e)};return{defaults:e,type:"itembox",initialize:function(){f.call(this),this.render(),j.call(this),i.call(this)},getUrl:function(a){var b=this.options.url.indexOf("?")===-1?"?":"&";return[this.options.url,b,this.options.idsParameter,"=",(a||[]).join(",")].join("")},getItemContent:function(a){return this.templates.contentItem(a)},sortHandler:function(a){this.setData(a,!1)},removeHandler:function(a){for(var b=this.getData(),c=-1,d=b.length;++c<d;)if(a===b[c]){b.splice(c,1);break}this.setData(b,!1)}}});